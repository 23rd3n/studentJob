[TOC]

# Camera Related Parts

## [Camera Estimation Code](cam_est)

- **cam_request_url1-2_process.py**

    - opens two ZED Cameras using pyzed library and sends the depth frames to the ML algorithms 
    who runs independently in two different hosts using two different processes who access the shared memory for 
    the frames generated from the two cameras.

    - Will generate two json files containing the server response delay and node_id

    - Also will genarate two different txt files containing the channel estimates 

    - NOTE: PATHS for these json and txt files should be modified inside the code

- **multi_camera.py**
    - The default code written for 2 ZED cameras 
    - [github for this repo](https://github.com/stereolabs/zed-multi-camera)
    - [pyzed API reference](https://www.stereolabs.com/docs/api/)

## [Server Overloading Code](overload_srv)

- Here there are two files that overloads a specific URL addres with the specified number of threads

    - **overload_url1.py**
    - **overload_url2.py**
    
- It uses a saved dummy data_frame which named data_cam12.json, therefore, the path of this file also should be modified.

- `python3 overload_url1.py -n NUM_THREADS` change the NUM_THREAD to specific integer

## [Virtual Camera Code](virtual_camera)

- Sends the frames that are received by cameras to the created virtual cameras in real-time

- [v4l2loopback should be installed](https://github.com/umlaeute/v4l2loopback)
    - clone the repository and build it
    - run  the module via `sudo modprobe v4l2loopback`
    - see number of virtual devices `ls -1 /sys/devices/virtual/video4linux`
    - create new devices with names video4 and video 5 `modprobe v4l2loopback video_nr=4,5`
    
- Here three files :

    - **selectCam.py**
        - if there is only one virtual camera is available, it provides a means of selecting which camera frames
        to be sent to this virtual camera.
        - `python3 selectCam.py cam1` sends first camera frames
        - `python3 selectCam.py cam2` sends the second camera frames

    - **VirCam.py**
        - if there are two virtual cameras are available, it sends the two camera frames to the two virtual cameras.
        - NOTE : devices names for virtual cameras should be modified in the code.

    - **vircam.desktop**
        - allows the script VirCam.py to run upon double clicking
        - NOTE : the path for Exec should be modified to state the path of VirCam.py

# [QUECTEL Drivers for lowest and newest kernels](quectel_drivers)

- [old_kernels](quectel_drivers/quectel_ubuntu_old_vers/)
    - Inside this folder there is a PDF explaining the installation steps and a zip file for drivers
- [new_kernels](quectel_drivers/quectel_ubuntu_22.04/)
    - Inside this folder, there is a readme that explains the installation steps and a zip file for new drivers

# [Free5GC .ova file and config files](free5gc_VM_files)

- [configs](free5gc_VM_files/configs/) includes the config files that I've used for my setup
- Also includes the .ova file for the importing the VM into any computer
- There may be some important issues whiling importing the appliance such as
network adapter configurations
- If the UPF gives an error such as UPF is already in use, go to gtp5g folder and rebuild it 
following the [free5gc](https://github.com/free5gc/free5gc/wiki/Installation)

# [OAI PDSCH(gNB) and plotting of DL,UL channel(UE,gNB)](oai_codes)

## OAI DL,UE Plotting and some channel stats included (at UE,gNB)
- It uses gnuplot to plot the DL,UL channel estimations on the OAI UE,gNB, it only plots it when
the 40MHz is fully utilized (it is modifiable)
- Reading estimates from the ML script and replacing them with OAI estimates.
- There is a fixed2real variable which is added to combat the differences between OAI low level programming, it maps the values of the array into the interval of [0,1]
- Therefore gnuplot should be insallted in the system: `sudo apt-get install gnuplot gnuplot-x11 gnuplot-doc `
- Also there should be txt file who comprises of two lines: the first one for node_id and the second one for the 
612 elements of 4 decimal float points, channel values. You should modify the name and path of this txt file
- Also this code checks if the node_id changes, therefore if node_id doesn't change (the channel doesn't get updated
by another script) then the plot also won't be updated. This part can be removed.
- It compares the channel generated by OAI and the channel read from this txt file
- In `ue->measurements` struct there are some channel stats such as
    - `rx_power_avg_dB`
    - `rx_rssi_dBm`
    - `wideband_cqi_avg`
are added to be shown in the title section of the plot. To see how are they calculated, these stats are
measured and updated in the `/openair1/PHY/NR_UE_ESTIMATION/nr_ue_measurements.c`
- Normally, it is reported by OAI community that channel stats are only reported in MIMO case (more than 1 layer);however,
these stats might give some impression about the signals that are tx/rx'ed.

## OAI Changing PDSCH Values (at gNB)
- First it reads the PDSCH values from a txt file (that is written because at later point these PDSCH values
will be gotten from another script like ML algorithm)
- Then it changes the PDSCH values with the ones that it read from the .txt file.
- NOTE: the paths of these txt files should be modified inside the code
- For detail of the code parts, click on the header and go to the readme inside.

## Some Commands for running the gNB and UE
- For detailed commands please refer to the [README](oai_configs)

# [flexRANsim](flexRANsim)

- Running and installation of OAIsim is well explained inside the README.md file of oaisim itself.
- Includes the attempted DL plotting and PDSCH amplitude change for resource blocks
- For detailed information [READMEfile](flexRANsim/README.md)
- There are two eNBs are running, the modifications that I've made is here:
    - ip address that ends with .130 (it is named as eNB1) 
    - the CN runs as a virtual machine under this machine.
- The original running one's ip ends with .137 (and named as eNB0 in noMachine as convention)

# [OAI config files for gNB and UE](oai_configs)

- All config file that I'm using
- 20Mhz, 40Mhz, x410, B210, n78 3.74e9 Band, Default OAI band
- For further details click on the header and go to the readme inside.

# [Results of some TP and Delay Tests](TP_Delay_tests)
- Includes some of the TP and Delay Tests
- For further details click on the header and go to the readme inside.

# nr-qtscope by OAI
**CHECK IF QTv5 IS INSTALLED**
`dpkg -l libqt5charts5-dev`
**IFNOT,  INSTALL VIA**
`sudo apt-get install libqt5charts5-dev`

**THEN BUILD THE GNB AND UE AGAIN VIA (ADDED `--build-lib nrqtscope`)**
`./build_oai --gNB -w USRP --nrUE --build-lib nrqtscope`

**THEN FOR GNB SCOPE  RUN (ADDED `--dqt`)**
`sudo ./nr-softmodem --sa -O ../../../targets/PROJECTS/GENERIC-NR-5GC/CONF/gnb.sa.band78.fr1.51PRB.1x1.usrpx410_new.conf --usrp-tx-thread-config 1 --continous-tx --gNBs.[0].min_rxtxtime 6 --dqt`

**FOR UE SCOPE RUN (ADDED `--dqt`)**
`sudo ./nr-uesoftmodem -r 51 --numerology 1 --band 78 -C 3309480000  --ssb 238 --ue-fo-compensation  --sa -O ../../../targets/PROJECTS/GENERIC-NR-5GC/CONF/ue.conf --dqt`

# A PDF file for installation of Open5gs with OAI RAN is inside this folder
- PDU Session is established and UE gets an IP but no connection to outside world has been achieved.
- Maybe getting the internet is my fault, can be tried again.
- Detailed instructions for the installation is inside the PDF.